<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <title>List</title>
  </head>
  <body>
    <div class="container">
        <h1>List</h1>
        <div align="right">
            <button id="addData" class="btn btn-sm btn-primary mb-4" onclick="showForm('add')">Add Data</button>
        </div>
        <form id="form" style="display: none;">
            <div align="right">
                <button id="return" class="btn btn-sm btn-primary mb-4" onclick="getData()">Back</button>
            </div>
            <input type="hidden" id="param">
            <input type="hidden" id="id">
            <div class="form-group">
                <label for="title">Title</label>
                <input type="text" class="form-control" id="title" placeholder="Title">
            </div>
            <button type="button"onclick="submitForm()" class="btn btn-primary">Submit</button>
        </form>
        <table class="table" id="dataTable">
            <thead>
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">Title</th>
                    <th scope="col">Created At</th>
                    <th scope="col">Update At</th>
                    <th scope="col">Action</th>
                </tr>
            </thead>
            <tbody id="table-body">
            </tbody>
        </table>
    </div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.6.3.js" integrity="sha256-nQLuAZGRRcILA+6dMBOvcRh5Pe310sBpanc6+QBmyVM="crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script>
        let baseurl = "http://localhost:3000/";
        $(document).ready(function(){
            getData();
        });
        function kosongtable() {
            $('#dataTable').show();
            $('#form').hide();
            $('#addData').show();
            $('#table-body > tr').remove();
        };
        function getData(){
            let data = '';
            $.ajax({
                url: baseurl + 'list',
                method : 'GET',
                success(result){
                    kosongtable();
                    $.each(result.list, function(index, data){
                        data += `<tr>
                            <td>${index + 1}</td>
                            <td>${data.title}</td>
                            <td>${data.createdAt}</td>
                            <td>${data.updatedAt}</td>
                            <td>
                                <button type="button"onclick="editdata(${data.id})" class="btn btn-sm btn-warning">Edit</button>
                                <button type="button"onclick="deletedata(${data.id})" class="btn btn-sm btn-danger">Delete</button>
                            </td>`;
                        $('#table-body').append(data);
                    });
                }
            });
        }
        function showForm(param, data = null){
            $('#dataTable').hide();
            $('#form').show();
            $('#addData').hide();
            $('#param').val(param);
            if(param == 'edit'){
                $('#title').val(data.title);
                $('#id').val(data.id);
            }
        }
        function clearForm(){
            $('#title').val('');
            $('#id').val('');
            $('#param').val('');
        }
        function submitForm(){
            let title = $('#title').val();
            let id = $('#id').val();
            let param = $('#param').val();
            if(title == ''){
                alert("Title is required");
            }else {
                if(param == 'add'){
                    $.ajax({
                        url: baseurl + 'list/create',
                        method: 'POST',
                        data : {
                            title : title
                        },
                        success(result) {
                            alert(result.message);
                            getData();
                            clearForm();
                        },
                        error(err){
                            alert(err.responseJSON.message);
                        }
                    });
                }else {
                    $.ajax({
                        url: baseurl + `list/${id}/update`,
                        method: 'POST',
                        data: {
                            title: title
                        },
                        success(result) {
                            alert(result.message);
                            getData();
                            clearForm();
                        },
                        error(err) {
                            alert(err.responseJSON.message);
                        }
                    });
                }
            }
        }
        function editdata(id){
            $.ajax({
                url: baseurl + `list/${id}`,
                method: 'GET',
                success(result) {
                    let list = result.list;
                    showForm('edit', list);
                },
                error(err) {
                    alert(err.responseJSON.message);
                }
            });
        }
        function deletedata(id){
            $.ajax({
                url: baseurl + `list/${id}/delete`,
                method: 'GET',
                success(result) {
                    alert(result.message);
                    getData();
                },
                error(err) {
                    alert(err.responseJSON.message);
                }
            });
        }
    </script>
  </body>
</html>